# -*- coding: utf-8 -*-
"""app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZUEUHvmKefPIHPqots4tCkvLT2VMnbBK
"""

pip install streamlit openpyxl

import streamlit as st
from datetime import datetime, timedelta
import pandas as pd
from io import BytesIO

# Function to calculate next Monday
def get_next_monday(date):
    order_dt = datetime.strptime(date, "%Y/%m/%d")
    days_ahead = 0 - order_dt.weekday() + 7
    if days_ahead <= 0:
        days_ahead += 7
    return order_dt + timedelta(days=days_ahead)

# Title of the web app
st.title("ðŸ“¦ Order Processing App")

# User inputs
st.header("ðŸ”– Order Information")
ref_no = st.text_input("Order Ref Number")
client_name_jp = st.text_input("Client Name (JP)")
client_name_en = st.text_input("Client Name (EN)")
order_date = st.text_input("Order Date (YYYY/MM/DD)")
qty = st.number_input("Quantity Ordered", min_value=1, step=1)
total_usd = st.number_input("Total Price (USD)", min_value=0.0, step=0.01)
tel_no = st.text_input("Telephone Number")
bar_code = st.text_input("Barcode")

if st.button("Generate Excel"):
    shipping_date = get_next_monday(order_date).strftime("%Y/%m/%d")

    # Cooling cubes calculation
    cooling_cubes = 4 if qty <= 50 else 6

    # Box determination
    if qty <= 20:
        box_type = "A"
    elif 21 <= qty <= 60:
        box_type = "B"
    else:
        box_type = "D"

    # Weight calculation data
    weights = {"babyderm": 11, "cooling_cube": 200, "A": 549, "B": 740, "D": 1172}
    buffer_stuff_weight = {"A": 200, "B": 300, "D": 500}

    net_weight = qty * weights["babyderm"]
    total_weight = net_weight + (cooling_cubes * weights["cooling_cube"]) + weights[box_type] + buffer_stuff_weight[box_type]

    # Excel generation
    excel_data = {
        "å‚™è¨»": [bar_code],
        "è¨‚å–®ç·¨è™Ÿ": [ref_no],
        "ç®±å­ç¨®é¡ž": [box_type],
        "ä¿å†·åŠ‘æ•¸é‡": [cooling_cubes],
        "é€šè·¯": ["H"],
        "æ‹‹æª”æ—¥": [order_date],
        "å¥‘å®¢åˆ¥": ["ä¹…æ³°é–‹ç™¼è‚¡ä»½æœ‰é™å…¬å¸"],
        "æ”¶ä»¶äºº": ["å°ç£é›…ç‘ªå¤šåœ‹éš›ç‰©æµè‚¡ä»½æœ‰é™å…¬å¸è¯å„²å€‰å„² æ¢å­å®—/å¼µå»ºè¯"],
        "é…é€åœ°å€": ["337æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªå‹¤åŒ—è·¯10-1è™Ÿ"],
        "TEL_NO": [tel_no],
        "ä»˜æ¬¾åç¨±ï¼ˆ1ï¼šä¸æ”¶æ¬¾2ï¼šä»£æ”¶è²¨æ¬¾ï¼‰": [1],
        "é…é€æ™‚æ®µï¼ˆ1ï¼š13é»žå‰2ï¼š13:00-17:003ï¼šä¸æŒ‡å®šï¼‰": [1],
        "å“è™Ÿ": ["3JS00005"],
        "å“å": ["BABYDERM-50"],
        "éŠ·è²¨æ•¸é‡": [qty],
        "é…é€æ—¥": [shipping_date]
    }

    df = pd.DataFrame(excel_data)

    # Prepare Excel for download
    output = BytesIO()
    with pd.ExcelWriter(output, engine='openpyxl') as writer:
        df.to_excel(writer, index=False)
    output.seek(0)

    # Provide download link
    st.success("âœ… Excel Generated Successfully!")
    st.download_button(
        label="ðŸ“¥ Download Excel",
        data=output,
        file_name='domestic_shipping.xlsx',
        mime='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    )